# 🧠 InsightAnalyzerAI ガバナンス

継承: `O:\Dev\CLAUDE.md` → `O:\Dev\Work\_orchestrator\CLAUDE.md` → このファイル

---

## 開発規範（O:\Dev\CLAUDE.md継承）

### 言語設定
**日本語一律使用**: 応答/コメント/commit全て日本語

### 基本原則
- **抽象化**: 共通処理100%/2箇所使用→即共通化/DRY/循環参照禁止
- **資源活用**: 既存確認必須/改良優先/修正時は全使用箇所確認

### 環境
- **Windows環境**: コマンド/パスはWindows形式
- **環境変数**: `.env`集約（toml/yaml禁止）

### 禁止事項
- 未テストコミット
- 認証情報ハードコード
- 脆弱性導入
- UTF-8以外のエンコーディング

### 言語別チェック
| 言語 | チェック |
|------|----------|
| TypeScript | ESLint+Prettier/型エラー/Jest |
| Python | black+isort/mypy/pytest |
| Rust | cargo clippy/fmt/テスト |

### 文書原則
AI向け最小文字数/圧縮形式/箇条書き/冗長禁止

### 問題解決
調査優先/段階的修正/安易な原因推測禁止

---

## ミッション

**AIによる人間代替作業の実行と収益化**

本プロジェクトのAIは**プロフェッショナル**として以下を遵守する：
- 収益を得るに相応しい品質の成果物を提供
- 誠実かつ妥協を許さない姿勢
- 批判的視点で自らの成果物を監査・昇華

**収益モデル**: データ分析サービス・レポート販売

---

## 📋 プロジェクト概要

**InsightAnalyzerAI** - AI駆動のデータ分析アシスタント

ユーザーがデータセットをアップロードし、自然言語で質問すると、AIが適切な分析を実行し結果を返すツール。

### 主要機能
- 自然言語によるデータ分析クエリ
- CSV/Excel等のデータ読み込み
- Pandasベースの分析実行
- チャート・可視化生成
- 自動インサイト発見

### 技術スタック
```
Python 3.11+
├── pandas          # データ処理
├── numpy           # 数値計算
├── matplotlib      # 可視化
├── plotly          # インタラクティブチャート
├── openai          # LLM統合（NL→クエリ変換）
├── streamlit       # Web UI（Phase 2）
└── pytest          # テスト
```

---

## 🎯 設計方針

### NL→クエリ変換アーキテクチャ
```
[ユーザー質問]
    ↓
[LLM (OpenAI/Claude)] ← スキーマ情報、カラム名
    ↓
[Pandasコード生成] または [疑似SQL生成]
    ↓
[サンドボックス実行]
    ↓
[結果検証] → エラー時はリトライ
    ↓
[回答テキスト + チャート]
```

### データサイズ対策
- 大規模データ: サンプリング（最大10万行）
- 要約統計の先行計算
- バックグラウンドジョブキュー（SaaS版）

### セキュリティ考慮
- ユーザーデータは処理後即削除（SaaS）
- 生成コードのサンドボックス実行
- APIキー環境変数管理
- 入力値のサニタイズ

---

## 💰 収益化戦略

### SaaSモデル（主軸）
| プラン | 月額 | 制限 |
|--------|------|------|
| Free | ¥0 | 1MB/ファイル, 10クエリ/日 |
| Basic | ¥2,980 | 50MB, 100クエリ/日, チャート |
| Pro | ¥9,800 | 500MB, 無制限, API連携 |
| Enterprise | 要相談 | オンプレ, カスタム |

### 価値提案
- **時間削減**: データアナリスト不要で即座に分析
- **コスト削減**: 月¥49相当で専門家相当の分析（vs 人件費）
- **アクセシビリティ**: 非技術者でもデータ活用可能

### ターゲット顧客
1. 中小企業（データ分析チームなし）
2. マーケティング担当者
3. 研究者（探索的データ分析）
4. スタートアップ

---

## 📅 開発フェーズ

### Phase 1: MVP ✅完了
- [x] CSV読み込み・基本統計（DataLoader）
- [x] CLI版インターフェース（insight_analyzer.py main()）
- [x] 単純なクエリ処理（QueryParser + QueryExecutor）
- [x] モジュール分離（query_parser, executor, visualizer）
- [x] 実行時間計測・確信度スコア
- [x] 基本チャート生成（Matplotlib）

### Phase 2: LLM統合（次）
- [ ] OpenAI API統合
- [ ] 自然言語→Pandasコード変換
- [ ] 結果の自然言語説明生成

### Phase 3: 可視化拡張
- [x] Matplotlibによるチャート生成（基本実装済み）
- [x] チャートタイプ自動選択（基本実装済み）
- [ ] Plotlyインタラクティブチャート
- [ ] より高度な可視化オプション

### Phase 4: Web UI
- [ ] Streamlitベースのインターフェース
- [ ] ファイルアップロード
- [ ] インタラクティブチャート

### Phase 5: 自動インサイト
- [ ] データスキャンによるパターン検出
- [ ] 異常値・トレンド自動発見
- [ ] レポート自動生成

### Phase 6: SaaS化
- [ ] ユーザー認証
- [ ] 課金システム統合
- [ ] マルチテナント対応

---

## 🧪 テスト戦略

### 検証レベル
1. **ユニットテスト**: 各関数の動作確認
2. **統合テスト**: LLM→実行→結果の一貫性
3. **正答性テスト**: 既知データで期待結果と比較
4. **セキュリティテスト**: 悪意あるクエリのブロック

### AI生成コードの検証
- サンプルデータで事前実行
- 結果の妥当性チェック（型、範囲）
- タイムアウト設定（長時間実行防止）

---

## 📁 ディレクトリ構造

```
InsightAnalyzerAI/
├── CLAUDE.md           # このファイル
├── README.md           # ユーザー向けドキュメント
├── requirements.txt    # Python依存関係
├── .gitignore
├── .claude/
│   └── settings.json   # Claude Code設定
├── src/
│   ├── __init__.py
│   ├── insight_analyzer.py   # メインモジュール
│   ├── data_loader.py        # データ読み込み
│   ├── query_parser.py       # NL→クエリ変換
│   ├── executor.py           # クエリ実行
│   └── visualizer.py         # チャート生成
├── data/
│   └── sample_sales.csv      # テスト用サンプル
├── tests/
│   ├── __init__.py
│   ├── test_data_loader.py
│   └── test_analyzer.py
├── notebooks/                 # プロトタイプ用
└── docs/                      # 追加ドキュメント
```

---

## ⚠️ 禁止事項

- 未検証のAI生成コードの本番実行
- ユーザーデータの永続保存（明示的同意なし）
- APIキーのハードコード
- eval/execの無制限使用

## ✅ 必須事項

- 全コード変更にテスト追加
- エラーハンドリング徹底
- 処理時間の計測・ログ
- 入力値検証

---

## 🔧 環境変数

```bash
OPENAI_API_KEY=sk-...          # LLM API
INSIGHT_ENV=development        # development/production
MAX_FILE_SIZE_MB=50            # アップロード制限
```

---

## セッション終了時の必須作業

**CRITICAL**: 作業終了前に必ず実行

1. **作業記録**: 変更内容を簡潔に記録（冗長禁止）
2. **Git Push**: 全変更をコミット＆プッシュ
3. **次回引継ぎ**: 未完了タスク・課題を明記

---

## セッション開始チェックリスト

- [ ] このCLAUDE.mdを確認
- [ ] `.claude/CORRECTION_ORDER.md`の有無確認（あれば最優先対応）
- [ ] `.claude/SESSION_REPORT.md`で前回の状態確認
- [ ] README.mdで現状把握
- [ ] 作業計画をTodoWriteで作成

---

## Orchestrator統制（CRITICAL）

### 強制レポート制度

本プロジェクトはOrchestratorの統制下にあり、以下を遵守する：

#### セッション終了時の必須更新
1. **SESSION_REPORT.md**（`.claude/SESSION_REPORT.md`）
   - 収益化進捗の記録
   - 今回の作業内容と収益貢献度
   - 次回必須アクション
   - 自己評価

2. **REVENUE_METRICS.md**（`.claude/REVENUE_METRICS.md`）
   - 収益状況に変更があれば更新
   - ロードマップ進捗の更新

#### 軌道修正指示への対応
- `.claude/CORRECTION_ORDER.md`が存在する場合は**最優先で対応**
- 対応完了後、ファイルを削除しセッションレポートに記録

### 収益化優先順位

| 優先度 | 作業種別 | 例 |
|--------|----------|-----|
| 1（最高） | 直接収益 | 課金機能、販売ページ |
| 2 | 収益準備 | MVP完成、ベータ版 |
| 3 | 収益基盤 | コア機能、品質向上 |
| 4 | 収益間接 | ドキュメント、テスト |
| 5（最低） | 非収益 | リファクタリングのみ |

**ルール**: 優先度5の作業は収益化完了まで原則禁止

### 逸脱の自己申告

収益化から逸れる作業を行う場合：
1. 理由をSESSION_REPORT.mdに記録
2. 収益化への影響を明記
3. 代替案または復帰計画を提示

---

## AI行動原則

### 自律的成長の姿勢
AIは指示待ちではなく、自ら考え、最善を尽くす：

| 原則 | 行動 |
|------|------|
| **自己駆動** | 指示がなくても必要な作業を自ら発見・提案 |
| **完遂責任** | 途中で止めない。完了まで責任を持つ |
| **品質追求** | 「動けばいい」ではなく「収益に値する品質」を追求 |
| **批判的思考** | 自分の成果物を厳しく評価し、改善点を見つける |
| **透明性** | 不明点・懸念点は隠さず明示する |

### 怠慢・省略の禁止

以下は**絶対禁止**：
- 「後でやる」と言って放置
- 「簡略化のため省略」と言って必要な処理をスキップ
- 「時間がないので」と言って品質を落とす
- 確認せずに推測で進める
- エラーを見なかったことにする

---

## 自己監査基準

プロフェッショナルとして、成果物提出前に以下を自問：

| 観点 | チェック |
|------|---------|
| 収益価値 | この成果物に対価を払う価値があるか？ |
| 品質 | 妥協した箇所はないか？ |
| 誠実性 | 不明点を曖昧にしていないか？ |
| 完全性 | 依頼された全要件を満たしているか？ |
| 継続性 | 次のセッションで引き継げる状態か？ |

**一つでもNoなら、提出前に改善すること**

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-01-05 | Orchestrator共通要件を追加 |
| 2026-01-05 | O:\Dev\CLAUDE.md継承規範を追加 |
| 2026-01-06 | AI行動原則・怠慢禁止・継続性観点を追加 |
| 2026-01-06 | Orchestrator統制規約を追加 |

<!--
Orchestrator管理タグ（編集禁止）
TEMPLATE_VERSION: 1.2
LAST_SYNC: 2026-01-06
ORCHESTRATOR_MANAGED: true
-->

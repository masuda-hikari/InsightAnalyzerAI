# 🧠 InsightAnalyzerAI ガバナンス

継承: O:\Dev\CLAUDE.md → このファイル

## 📋 プロジェクト概要

**InsightAnalyzerAI** - AI駆動のデータ分析アシスタント

ユーザーがデータセットをアップロードし、自然言語で質問すると、AIが適切な分析を実行し結果を返すツール。

### 主要機能
- 自然言語によるデータ分析クエリ
- CSV/Excel等のデータ読み込み
- Pandasベースの分析実行
- チャート・可視化生成
- 自動インサイト発見

### 技術スタック
```
Python 3.11+
├── pandas          # データ処理
├── numpy           # 数値計算
├── matplotlib      # 可視化
├── plotly          # インタラクティブチャート
├── openai          # LLM統合（NL→クエリ変換）
├── streamlit       # Web UI（Phase 2）
└── pytest          # テスト
```

---

## 🎯 設計方針

### NL→クエリ変換アーキテクチャ
```
[ユーザー質問]
    ↓
[LLM (OpenAI/Claude)] ← スキーマ情報、カラム名
    ↓
[Pandasコード生成] または [疑似SQL生成]
    ↓
[サンドボックス実行]
    ↓
[結果検証] → エラー時はリトライ
    ↓
[回答テキスト + チャート]
```

### データサイズ対策
- 大規模データ: サンプリング（最大10万行）
- 要約統計の先行計算
- バックグラウンドジョブキュー（SaaS版）

### セキュリティ考慮
- ユーザーデータは処理後即削除（SaaS）
- 生成コードのサンドボックス実行
- APIキー環境変数管理
- 入力値のサニタイズ

---

## 💰 収益化戦略

### SaaSモデル（主軸）
| プラン | 月額 | 制限 |
|--------|------|------|
| Free | ¥0 | 1MB/ファイル, 10クエリ/日 |
| Basic | ¥2,980 | 50MB, 100クエリ/日, チャート |
| Pro | ¥9,800 | 500MB, 無制限, API連携 |
| Enterprise | 要相談 | オンプレ, カスタム |

### 価値提案
- **時間削減**: データアナリスト不要で即座に分析
- **コスト削減**: 月¥49相当で専門家相当の分析（vs 人件費）
- **アクセシビリティ**: 非技術者でもデータ活用可能

### ターゲット顧客
1. 中小企業（データ分析チームなし）
2. マーケティング担当者
3. 研究者（探索的データ分析）
4. スタートアップ

---

## 📅 開発フェーズ

### Phase 1: MVP（現在）
- [ ] CSV読み込み・基本統計
- [ ] CLI版インターフェース
- [ ] 単純なクエリ処理（カラム合計、平均等）

### Phase 2: LLM統合
- [ ] OpenAI API統合
- [ ] 自然言語→Pandasコード変換
- [ ] 結果の自然言語説明生成

### Phase 3: 可視化
- [ ] Matplotlib/Plotlyによるチャート生成
- [ ] チャートタイプ自動選択

### Phase 4: Web UI
- [ ] Streamlitベースのインターフェース
- [ ] ファイルアップロード
- [ ] インタラクティブチャート

### Phase 5: 自動インサイト
- [ ] データスキャンによるパターン検出
- [ ] 異常値・トレンド自動発見
- [ ] レポート自動生成

### Phase 6: SaaS化
- [ ] ユーザー認証
- [ ] 課金システム統合
- [ ] マルチテナント対応

---

## 🧪 テスト戦略

### 検証レベル
1. **ユニットテスト**: 各関数の動作確認
2. **統合テスト**: LLM→実行→結果の一貫性
3. **正答性テスト**: 既知データで期待結果と比較
4. **セキュリティテスト**: 悪意あるクエリのブロック

### AI生成コードの検証
- サンプルデータで事前実行
- 結果の妥当性チェック（型、範囲）
- タイムアウト設定（長時間実行防止）

---

## 📁 ディレクトリ構造

```
InsightAnalyzerAI/
├── CLAUDE.md           # このファイル
├── README.md           # ユーザー向けドキュメント
├── requirements.txt    # Python依存関係
├── .gitignore
├── .claude/
│   └── settings.json   # Claude Code設定
├── src/
│   ├── __init__.py
│   ├── insight_analyzer.py   # メインモジュール
│   ├── data_loader.py        # データ読み込み
│   ├── query_parser.py       # NL→クエリ変換
│   ├── executor.py           # クエリ実行
│   └── visualizer.py         # チャート生成
├── data/
│   └── sample_sales.csv      # テスト用サンプル
├── tests/
│   ├── __init__.py
│   ├── test_data_loader.py
│   └── test_analyzer.py
├── notebooks/                 # プロトタイプ用
└── docs/                      # 追加ドキュメント
```

---

## ⚠️ 禁止事項

- 未検証のAI生成コードの本番実行
- ユーザーデータの永続保存（明示的同意なし）
- APIキーのハードコード
- eval/execの無制限使用

## ✅ 必須事項

- 全コード変更にテスト追加
- エラーハンドリング徹底
- 処理時間の計測・ログ
- 入力値検証

---

## 🔧 環境変数

```bash
OPENAI_API_KEY=sk-...          # LLM API
INSIGHT_ENV=development        # development/production
MAX_FILE_SIZE_MB=50            # アップロード制限
```
